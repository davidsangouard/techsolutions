<?php require_once '../includes/config.php'; if (!isset($_SESSION['admin_id'])) { header('Location: login.php'); exit; } $message = ''; if ($_SERVER['REQUEST_METHOD'] === 'POST') { if (isset($_POST['action'])) { if ($_POST['action'] === 'add') { $stmt = $pdo->prepare("INSERT INTO actualites (titre, contenu, auteur, statut) VALUES (?, ?, ?, ?)"); $stmt->execute([trim($_POST['titre']), trim($_POST['contenu']), $_SESSION['admin_username'], $_POST['statut']]); $message = 'Actualité ajoutée'; } elseif ($_POST['action'] === 'delete') { $stmt = $pdo->prepare("DELETE FROM actualites WHERE id = ?"); $stmt->execute([$_POST['id']]); $message = 'Actualité supprimée'; } } } $stmt = $pdo->query("SELECT * FROM actualites ORDER BY date_publication DESC"); $actualites = $stmt->fetchAll(); ?><!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Actualités - Admin</title><link rel="stylesheet" href="../css/style.css"></head><body><header><div class="header-content"><div class="logo"><h1>Admin - TechSolutions</h1></div><nav><ul><li><a href="dashboard.php">Tableau de bord</a></li><li><a href="actualites.php">Actualités</a></li><li><a href="contacts.php">Messages</a></li><li><a href="composants.php">Composants</a></li><li><a href="logout.php">Déconnexion</a></li></ul></nav></div></header><div class="container"><h2>Gestion des Actualités</h2><?php if($message): ?><div class="message success"><?php echo $message; ?></div><?php endif; ?><div class="content-box"><h3>Ajouter une Actualité</h3><form method="POST"><input type="hidden" name="action" value="add"><div class="form-group"><label>Titre:</label><input type="text" name="titre" required></div><div class="form-group"><label>Contenu:</label><textarea name="contenu" required></textarea></div><div class="form-group"><label>Statut:</label><select name="statut"><option value="brouillon">Brouillon</option><option value="publie">Publié</option></select></div><button type="submit">Ajouter</button></form></div><div class="content-box"><h3>Liste des Actualités</h3><table><thead><tr><th>Titre</th><th>Date</th><th>Statut</th><th>Actions</th></tr></thead><tbody><?php foreach($actualites as $actu): ?><tr><td><?php echo htmlspecialchars($actu['titre']); ?></td><td><?php echo date('d/m/Y', strtotime($actu['date_publication'])); ?></td><td><?php echo ucfirst($actu['statut']); ?></td><td><form method="POST" style="display:inline;" onsubmit="return confirm('Supprimer ?');"><input type="hidden" name="action" value="delete"><input type="hidden" name="id" value="<?php echo $actu['id']; ?>"><button type="submit" class="btn-danger">Supprimer</button></form></td></tr><?php endforeach; ?></tbody></table></div></div><footer><p>&copy; 2025 TechSolutions</p></footer></body></html>
